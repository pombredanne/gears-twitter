/*! Fuel UX Gear API - v0.0.17 - 2013-04-03
* https://github.com/ExactTarget/fuelux-gearapi
* Copyright (c) 2013 ExactTarget; Licensed  */
(function(a,b){typeof define=="function"&&define.amd?define("postmonger",[],b):a.Postmonger=b(a)})(this,function(a){var b=b||undefined,c,d=a.Postmonger,e=a.addEventListener||a.attachEvent?a:window,f,g,h;return typeof b!="undefined"?c=b:c={},c.noConflict=function(){return a.Postmonger=d,this},c.version="0.0.10",f=c.Connection=function(a){a=typeof a=="object"?a:{};var b=a.connect||e.parent,c=a.from||"*",d=a.to||"*",f=this;return typeof b=="string"&&(b=document.getElementById(b)),b&&!b.postMessage&&b.jquery&&(b=b.get(0)),b&&!b.postMessage&&(b.contentWindow||b.contentDocument)&&(b=b.contentWindow||b.contentDocument),!b||!b.postMessage?(e.console&&e.console.warn&&e.console.warn(" Warning: Postmonger could not establish connection with ",a.connect),!1):(f.connect=b,f.to=d,f.from=c,f)},g=c.Events=function(){var a=/\s+/,b=this;return b._callbacks={},b._has=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b._keys=function(a){if(Object.keys)return Object.keys(a);if(typeof a!="object")throw new TypeError("Invalid object");var c=[];for(var d in a)b._has(a,d)&&(c[c.length]=d);return c},b.on=function(c,d,e){var f,g,h,i,j;if(!d)return b;c=c.split(a),b._callbacks=b._callbacks||{},f=b._callbacks;while(g=c.shift())j=f[g],h=j?j.tail:{},i={},h.next=i,h.context=e,h.callback=d,f[g]={tail:i,next:j?j.next:h};return b},b.off=function(c,d,e){var f=b._callbacks,g,h,i,j,k;if(!f)return;if(!(c||d||e))return delete b._callbacks,b;c=c?c.split(a):b._keys(f);while(g=c.shift()){h=f[g],delete f[g];if(!h||!d&&!e)continue;i=h.tail;while((h=h.next)!==i)j=h.callback,k=h.context,((d&&j)!==d||(e&&k)!==e)&&b.on(g,j,k)}return b},b.trigger=function(c){var d,e,f,g,h,i,j;if(!(f=b._callbacks))return b;i=f.all,c=c.split(a),j=Array.prototype.slice.call(arguments,1);while(d=c.shift()){if(e=f[d]){g=e.tail;while((e=e.next)!==g)e.callback.apply(e.context||b,j)}if(e=i){g=e.tail,h=[d].concat(j);while((e=e.next)!==g)e.callback.apply(e.context||b,h)}}return b},b},h=c.Session=function(){var b=arguments.length>0?Array.prototype.slice.call(arguments,0):[{}],c=[],d=new g,h=new g,i=this,j,k,l,m,n,o;i.on=d.on,i.off=d.off,i.trigger=h.trigger,i.end=function(){return d.off(),h.off(),e.removeEventListener?e.removeEventListener("message",o,!1):e.detachEvent&&e.detachEvent("onmessage",o),i};for(k=0,m=b.length;k<m;k++){j=new f(b[k]);if(j){for(l=0,n=c.length;l<n;l++)if(c[l].connect===j.connect&&c[l].from===j.from&&c[l].to===j.to){j=null;break}j&&c.push(j)}}o=function(b){var e=null,f=[],g,h,i;for(h=0,i=c.length;h<i;h++)if(c[h].connect===b.source){e=c[h];break}if(!e)return!1;if(e.from!=="*"&&e.from!==b.origin)return!1;try{g=JSON.parse(b.data);if(!g.e)return!1}catch(j){return!1}f.push(g.e),delete g.e;for(h in g)f.push(g[h]);d.trigger.apply(a,f)};if(e.addEventListener)e.addEventListener("message",o,!1);else if(e.attachEvent)e.attachEvent("onmessage",o);else return e.console&&e.console.warn&&e.console.warn("WARNING: Postmonger could not listen for messages on window %o",e),!1;return h.on("all",function(){var a=Array.prototype.slice.call(arguments,0),b={},d,e;b.e=a[0];for(d=1,e=a.length;d<e;d++)b["a"+d]=a[d];for(d=0,e=c.length;d<e;d++)c[d].connect.postMessage(JSON.stringify(b),c[d].to)}),i},c}),function(a,b){typeof define=="function"&&define.amd?define("fuelux-gearapi/dialog",["postmonger"],function(c){b(a,c)}):b(a,a.Postmonger)}(this,function(a,b){return a.FUELUX_GEAR=new b.Session,a.FUELUX_GEAR});